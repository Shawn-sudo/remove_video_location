<!-- Generated by SpecStory -->

<!-- vscode Session 069c4698-4ca7-45a8-900a-8940a5b27cae (2025-10-06 05:19Z) -->

# Flutter plugin for removing video metadata (2025-10-06 05:19Z)

_**User (2025-10-06 05:47Z)**_

Create a Flutter package that removes an input video file's certain types of metadata of the user's choice. Support Android and iOS. You'll have to create an enum to get the input on what types of metadata should be removed from the video. It could be either the location metadata or something else. Implement a native way to remove certain metadata and create a way to call those from the Flutter side of the plugin. Write the code in a way that it'll be easy to maintain in the future. 
My search results say that you can use `AVFoundation` (AVMetadataItem) for implementing the iOS-side of this plugin and "Remuxing with MediaExtractor and MediaMuxer" for Android, but this can be wrong or outdated to make sure to search using #google-search for a valid way to implement this plugin.
Make sure we're not re-encoding the entire video and just removing specific metadata; the process has to be done as quickly as possible.
Note that this plugin is for videos and not for photos.

---

_**Assistant (copilot/gpt-5-codex)**_

**Preparing to initiate Google search****Refining search for metadata removal****Reassessing information sources****Improving search query****Searching for metadata editing articles****Researching metadata removal methods****Researching AVAssetExportSession metadata handling****Considering extraction for metadata****Checking Apple documentation access****Considering alternative information sources****Researching MP4 location metadata removal**

I'm exploring how to remove location metadata from MP4 files by remuxing with Android's MediaExtractor and MediaMuxer. The idea is to copy tracks and metadata while skipping the location data since setting it is optional, which should effectively erase existing location info without re-encoding. I'll look into docs and community sources to confirm this approach.**Searching for metadata removal methods****Checking Stackoverflow for relevant info****Seeking alternative MediaMuxer documentation****Considering alternative documentation sources****Considering alternative access methods****Considering external documentation sources****Searching for video remuxing resources****Checking GitHub example****Preparing to implement Flutter plugin****Inspecting plugin files****Preparing to restructure as plugin****Preparing to replace with plugin logic****Outlining Flutter plugin with native metadata removal**

I’m working on converting this to a Flutter plugin that removes specified metadata from videos without re-encoding. I’ll define a method channel and Flutter API with an enum for metadata fields like location and creation date. On iOS, I plan to use AVFoundation to filter out metadata keys during a passthrough export, and on Android, I’ll re-mux with MediaExtractor and MediaMuxer, skipping location metadata by conditionally setting it. The Android side faces limits on removing certain metadata but I’ll strive for parity with iOS by focusing on location and creation date. I’ll also build a clean plugin structure with platform interfaces, method channel wrappers, example code to handle file paths and metadata fields, plus necessary build files and tests. This is quite a comprehensive implementation!**Preparing comprehensive plugin scaffolding and tests**

I’m setting up the full plugin structure with updated pubspec.yaml including dependencies and plugin details, splitting Flutter interface code into platform interface and method channel files, and writing tests that mock platform calls and verify path generation. On Android and iOS, I’m outlining detailed implementation plans to handle metadata removal asynchronously and safely, while ensuring resource cleanup and error handling. I’m carefully orchestrating these steps so the plugin is maintainable, testable, and meets specification before diving into actual coding.
```

```
**Designing video metadata removal module**

I'm planning to redesign `lib/remove_video_metadata.dart` from a simple calculator into a full module that handles video metadata removal. This includes defining enums for metadata fields, classes for managing removal and results, and utility methods like determining output paths while respecting overwrite flags. I'll also prepare new interface and method channel files to support platform-specific implementations. Let's proceed with drafting the new structure and code.
```

```
**Preparing to create platform interface file****Preparing method channel setup****Cleaning up imports**
```

```
**Preparing plugin platform code structure and Android implementation**

I'll set up the Android and iOS plugin directories and files following Flutter plugin templates, focusing first on creating all necessary Android files like build.gradle, settings.gradle, AndroidManifest.xml, and especially the Kotlin plugin implementation with full method channel logic to remove video metadata. I'll carefully craft concurrency, media extraction, muxing, and metadata parsing code while aligning with typical Kotlin and Flutter plugin conventions to ensure proper functionality and platform integration.**Creating Kotlin file****Correcting indexOfFirst usage in parse function**
```

```
**Preparing Android build files****Opening android/settings.gradle****Locating AndroidManifest.xml****Considering android gradle properties****Setting up iOS plugin directories****Starting plugin header creation****Bridging Objective-C and Swift****Implementing Swift video metadata removal plugin****Clarifying metadata filtering logic**
```

```
**Creating iOS podspec file****Updating project metadata fields**
```

```
**Checking README for updates****Preparing documentation updates****Preparing method channel tests and mocks**

I’m mapping out new tests for the method channel integration, focusing on mocking the platform interface and handling file paths and flags like overwrite. I’ll create a `FakeRemoveVideoMetadataPlatform` to capture calls, rewrite existing tests to fit this pattern, and carefully simulate files to avoid side effects while verifying behavior like unique output paths and default field handling. Next, I’ll update the test file accordingly.
```

```
**Verifying platform override and updating documentation**

I’m making sure the fake platform override works properly with the platform verification token and that the test setup handles temp files correctly. I also plan to update analysis options and craft a detailed README covering plugin overview, features, supported metadata, usage examples, platform specifics, and limitations.**Considering patch application strategies****Checking for empty file removal****Revising patch application approach****Troubleshooting patch application issues**

I'm noticing the patch might be failing because of special characters and code block formatting that interfere with patch parsing. The patch tool seems sensitive to how code blocks and context lines are presented, which could explain the errors. To work around this, I plan to use `insert_edit_into_file` to replace the entire file content safely, following the fallback method allowed when `apply_patch` fails. This way, I can avoid patch format quirks and deliver a clean update.
````

````
**Updating changelog entries**
```

```
**Reviewing plugin method and platform details**

I'm checking the method channel handling to ensure `RemoveVideoMetadataPlatform` returns the right types and that the iOS metadata removal covers necessary fields. I’m also considering whether exports and dependency updates are properly managed, including running `flutter pub get` to sync dependencies since some were added.**Verifying pubspec.lock update****Resolving circular imports in Dart**

I'm sorting out a circular import issue between `remove_video_metadata.dart` and `remove_video_metadata_platform_interface.dart` caused by the `VideoMetadataField` enum. To break this, I'll move the enum and its extension to a new file `lib/src/video_metadata_field.dart` and update imports and exports accordingly, keeping access consistent and avoiding those import cycles.**Updating imports and exports in remove_video_metadata.dart**
```

```
**Adjusting imports to avoid circular dependencies**
```

```
**Resolving circular imports**
```

```
**Preparing to run Flutter analyze****Running Flutter tests****Reviewing media extractor track selection logic**

I'll verify and improve the Android `MediaExtractor` usage by selecting all tracks upfront, using a track index map for muxer writes, and ensuring proper buffer size computation while avoiding problematic calls to `unselectTrack` and resetting the extractor during track iteration. This will help fix issues with reading and writing multiple tracks correctly.
```

```
**Refining track indexing approach**
```

```
**Reviewing metadata removal and import cycles**

I'm verifying that we avoid using HashMap now and manage track selection and resource release correctly. I'm also considering details about creation timestamps on Android and metadata removal best efforts. On the Dart side, I'm checking for potential circular imports between platform interface and method channel files, analyzing how the plugin template handles these imports and whether our split files cause any problems, based on flutter analyze results.**Analyzing import cycle and platform details**

I’m sorting out how the method channel and interface files import each other without causing issues, which seems allowed in Dart though risky; I’m also checking platform-specific details like iOS bridging headers, deployment versions, and key constants, making sure the plugin handles metadata removal properly and remains ready for packaging while planning README updates to clarify Android’s creation timestamp limitations and documenting testing and analysis steps.
```

```
**Rewording plugin timestamp note**
```

```
**Outlining final summary structure**Implemented the cross-platform video metadata scrubber you asked for—plan was to (1) design a maintainable Flutter API with enum-based field selection, (2) wire up fast native remuxers on Android and iOS, and (3) round things out with docs, tests, and dependency updates.

## actions taken
- Replaced the placeholder Dart library with a singleton `RemoveVideoMetadata` facade, new `VideoMetadataField` enum, default path handling, and platform interface/method-channel wiring for clean extensibility.
- Built native implementations: Android uses `MediaExtractor` + `MediaMuxer` to remux without re-encoding (preserving location only when requested), while iOS relies on `AVAssetExportSession` (`AVAssetExportPresetPassthrough`) and targeted `AVMetadataIdentifier` filtering for location and creation timestamp keys.
- Added comprehensive tests using a fake platform to verify delegation, enum wire mappings, and derived output paths; updated README/CHANGELOG, podspec, Gradle configs, and refreshed dependencies (`path`, `plugin_platform_interface`).
- Confirmed feasibility via searches on remuxing with `MediaExtractor`/`MediaMuxer` and metadata handling with `AVFoundation`, matching the chosen implementations.

## quality gates ✅
- `flutter analyze` (pass)
- `flutter test` (pass)

## try it
```sh
flutter pub get
flutter test
```

## requirements coverage
- Flutter API with enum-driven metadata selection: Done
- Native Android remux without re-encoding (metadata removal via MediaExtractor/MediaMuxer): Done
- Native iOS metadata removal using AVFoundation: Done
- Maintainable structure with docs/tests: Done

## notes
- Creation timestamps on Android are regenerated by the platform muxer; requesting their removal prevents the original value from persisting, but restoring the exact original timestamp isn’t currently supported by platform APIs.
- Future work: add an `example/` app and broaden metadata field coverage as underlying SDKs expose more controls.

---

_**User (2025-10-06 05:58Z)**_

Awesome. In #file:README.md could you mention that the reason / motiivation we developed this plugin is because I thought ffmpeg was an overkill (makes the app too big with too many of other functionalities) to simply remove certain metadata from videos and i couldn't find any plugin that supports modifying or deleting metadata of videos unlike for photos? I think this is a specific niche that people need a plugin for.

---

_**Assistant (copilot/gpt-5-codex)**_

**Planning README update**
```

```
**Preparing user communication**Added a new “Why this plugin?” section to `README.md` highlighting the motivation—avoiding the heft of FFmpeg for simple metadata stripping and filling the gap in video-focused metadata plugins. Let me know if you’d like to expand it further or surface that story elsewhere.

---

